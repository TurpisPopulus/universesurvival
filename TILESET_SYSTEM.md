# Система работы с тайлсетами

## Описание

Реализована универсальная система для работы с различными наборами тайлов (тайлсетами). Система автоматически считывает тайлы из PNG-изображений по сетке 32x32 пикселя и позволяет переключаться между разными тайлсетами прямо в редакторе.

## Структура файлов

### Измененные файлы:

1. **TilePalette.gd** - Палитра тайлов с выпадающим списком
   - Изменен базовый класс с `TextureRect` на `VBoxContainer`
   - Добавлен выпадающий список (OptionButton) для выбора тайлсета
   - Добавлен сигнал `tileset_changed`
   - Автоматическое считывание конфигурации из JSON

2. **WorldMap.gd** - Карта мира
   - Добавлен метод `load_tileset(tileset_name: String)`
   - Добавлен метод `_get_tileset_path(tileset_name: String)`
   - Добавлен метод `_get_default_tileset_path(tileset_name: String)`
   - Поддержка динамической загрузки тайлсетов

3. **UnifiedMapEditor.gd** - Объединенный редактор карты
   - Подключение сигнала `tileset_changed` от TilePalette
   - Добавлен обработчик `_on_tileset_changed(tileset_name: String)`

### Новые файлы:

4. **data/tilesets.json** - Конфигурация тайлсетов
   ```json
   {
     "tilesets": [
       {
         "name": "terrain",
         "displayName": "Terrain",
         "path": "res://tiles/terrain.png"
       },
       {
         "name": "ground",
         "displayName": "Ground",
         "path": "res://tiles/Ground.png"
       }
     ]
   }
   ```

## Как использовать

### В редакторе:

1. Откройте редактор карты
2. В верхней части палитры тайлов появится выпадающий список
3. Выберите нужный тайлсет из списка (terrain или ground)
4. Кликните на любой квадратик 32x32 в палитре - он выделится белой рамкой
5. Рисуйте на карте выбранным тайлом, кликая левой кнопкой мыши

### Добавление новых тайлсетов:

1. Поместите PNG-файл с тайлами в папку `tiles/`
2. Откройте файл `data/tilesets.json`
3. Добавьте новую запись:
   ```json
   {
     "name": "my_tileset",
     "displayName": "My Tileset",
     "path": "res://tiles/my_tileset.png"
   }
   ```
4. Сохраните файл

### Требования к изображениям тайлсетов:

- Формат: PNG
- Размер тайла: 32x32 пикселя
- Общий размер изображения должен быть кратен 32
- Тайлы располагаются слева направо, сверху вниз
- Пример: изображение 192x384 содержит 6 столбцов и 12 строк = 72 тайла

## Принцип работы

### Автоматическая нумерация тайлов:

Тайлы нумеруются автоматически слева направо, сверху вниз:

```
+----+----+----+----+
|  0 |  1 |  2 |  3 |
+----+----+----+----+
|  4 |  5 |  6 |  7 |
+----+----+----+----+
|  8 |  9 | 10 | 11 |
+----+----+----+----+
```

Формула: `tile_id = row * columns + column`

### Выделение тайла:

При клике на тайл в палитре:
1. Определяются координаты (x, y) в сетке
2. Вычисляется `tile_id`
3. Посылается сигнал `tile_selected(tile_id)`
4. WorldMap получает сигнал и устанавливает выбранный тайл
5. При клике на карту размещается выбранный тайл

### Переключение тайлсета:

При выборе другого тайлсета из списка:
1. Посылается сигнал `tileset_changed(tileset_name)`
2. WorldMap загружает новый тайлсет
3. Создается новый атлас тайлов
4. Палитра обновляет отображение
5. Можно продолжать рисовать новыми тайлами

## Fallback механизм

Если файл конфигурации `data/tilesets.json` не найден или некорректен, система использует дефолтные тайлсеты:

```gdscript
{
  "terrain": "res://tiles/terrain.png",
  "ground": "res://tiles/Ground.png"
}
```

## Пример использования Ground.png

Файл `tiles/Ground.png` содержит различные типы земли:
- Травянистые поверхности
- Песок
- Камни
- Грязь
- Снег
- И другие варианты

Каждый тип занимает квадрат 32x32 пикселя и может быть выбран отдельно для рисования на карте.

## Расширение системы

### Добавление поддержки разных размеров тайлов:

В конфигурации можно добавить параметр `tileSize`:

```json
{
  "name": "big_tiles",
  "displayName": "Big Tiles",
  "path": "res://tiles/big_tiles.png",
  "tileSize": 64
}
```

Потребуется обновить код для чтения этого параметра.

### Группировка тайлсетов:

Можно добавить категории:

```json
{
  "categories": [
    {
      "name": "Terrain",
      "tilesets": [...]
    },
    {
      "name": "Objects",
      "tilesets": [...]
    }
  ]
}
```

## Известные ограничения

1. Все тайлы в одном изображении должны быть одного размера (32x32)
2. Размер изображения должен быть кратен размеру тайла
3. При переключении тайлсета все незасохраненные изменения сохраняются
4. Нельзя использовать тайлы из разных тайлсетов одновременно на одной карте

## Дальнейшие улучшения

Возможные направления развития:
- [ ] Поддержка разных размеров тайлов в одном проекте
- [ ] Превью тайлсета при наведении
- [ ] Поиск тайлов по названию/тегам
- [ ] Группировка тайлсетов по категориям
- [ ] История последних использованных тайлов
- [ ] Горячие клавиши для переключения тайлсетов
